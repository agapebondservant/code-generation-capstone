## 7.2 HTTP 1.1 Response Headers and Their Meaning

## · setContentType

This method sets the Content-Type header and is used by the majority of servlets. See Section 7.5 (Using Servlets to Generate GIF Images) for an example of its use.

## · setContentLength

This method sets the Content-Length header, which is useful if the browser supports persistent (keep-alive) HTTP connections. See Section 7.4 for an example.

## · addCookie

This method inserts a cookie into the Set-Cookie header. There is no corresponding setCookie method, since it is normal to have multiple Set-Cookie lines. See Chapter 8 for a discussion of cookies.

## · sendRedirect

As discussed in the previous chapter, the sendRedirect method sets the Location header as well as setting the status code to 302. See Section 6.3 (A Front End to Various Search Engines) for an example.

## 7.2 HTTP 1.1 Response Headers and Their Meaning

Following is a summary of the HTTP 1.1 response headers. A good understanding of these headers can increase the effectiveness of your servlets, so you should at least skim the descriptions to see what options are at your disposal. You can come back to get details when you are ready to make use of the  capabilities.  Note  that  Appendix  A  (Servlet  and  JSP  Quick  Reference) presents a brief summary of these headers for use as a reminder.

These headers are a superset of those permitted in HTTP 1.0. For additional details on these headers, see the HTTP 1.1 specification, given in RFC 2616. There are a number of places the official RFCs are archived on-line; your best bet is to start at http://www.rfc-editor.org/ to get a current list of the archive sites. Header names are not case sensitive, but are traditionally written with the first letter of each word capitalized.

Be cautious in writing servlets whose behavior depends on response headers that are only available in HTTP 1.1, especially if your servlet needs to run on the WWW 'at large,' rather than on an intranet-many older browsers support only HTTP 1.0. It is best to explicitly check the HTTP version with request.getRequestProtocol before using new headers.

## Chapter 7 Generating the Server Response: HTTP Response Headers

## Accept-Ranges

This header, which is new in HTTP 1.1, tells the client whether or not you accept Range request headers. You typically specify a value of bytes to indicate that you accept Range requests, and a value of none to indicate that you do not.

## Age

This header is used by proxies to indicate how long ago the document was generated by the original server. It is new in HTTP 1.1 and is rarely used by servlets.

## Allow

The Allow header specifies the request methods ( GET , POST , etc.) that the server supports. It is required for 405 ( Method Not Allowed ) responses. The default service method of servlets automatically generates this header for OPTIONS requests.

## Cache-Control

This useful header tells the browser or other client the circumstances in which the response document can safely be cached. It has the following possible values:

- · public : Document is cacheable, even if normal rules (e.g., for password-protected pages) indicate that it shouldn't be.
- · private : Document is for a single user and can only be stored in private (nonshared) caches.
- · no-cache : Document should never be cached (i.e., used to satisfy a later request). The server can also specify ' no-cache="header1,header2,...,header N " ' to indicate the headers that should be omitted if a cached response is later used. Browsers normally do not cache documents that were retrieved by requests that include form data. However, if a servlet generates different content for different requests even when the requests contain no form data, it is critical to tell the browser not to cache the response. Since older browsers use the Pragma header for this purpose, the typical servlet approach is to set both headers, as in the following example.

response.setHeader("Cache-Control", "no-cache");

response.setHeader("Pragma", "no-cache");

## 7.2 HTTP 1.1 Response Headers and Their Meaning

- · no-store : Document should never be cached and should not even be stored in a temporary location on disk. This header is intended to prevent inadvertent copies of sensitive information.
- · must-revalidate : Client must revalidate document with original server (not just intermediate proxies) each time it is used.
- · proxy-revalidate : This is the same as must-revalidate , except that it applies only to shared caches.
- · max-age= xxx : Document should be considered stale after xxx seconds. This is a convenient alternative to the Expires header, but only works with HTTP 1.1 clients. If both max-age and Expires are present in the response, the max-age value takes precedence.
- · s-max-age= xxx : Shared caches should consider the document stale after xxx seconds.

The Cache-Control header is new in HTTP 1.1.

## Connection

A value of close for this response header instructs the browser not to use persistent HTTP connections. Technically, persistent connections are the default when the client supports HTTP 1.1 and does not specify a ' Connection: close ' request header (or when an HTTP 1.0 client specifies ' Connection: keep-alive '). However, since persistent connections require a Content-Length response header, there is no reason for a servlet to explicitly use the Connection header. Just omit the Content-Length header if you aren't using persistent connections. See Section 7.4 (Using Persistent HTTP Connections) for an example of the use of persistent HTTP connections from servlets.

## Content-Encoding

This header indicates the way in which the page was encoded during transmission. The browser should reverse the encoding before deciding what to do with the document. Compressing the document with gzip can result in huge savings in transmission time; for an example, see Section 4.4 (Sending Compressed Web Pages).

## Content-Language

The Content-Language header signifies the language in which the document is written. The value of the header should be one of the standard language codes such as en , en-us , da , etc. See RFC 1766 for

Home page for this book: www.coreservlets.com; Home page for sequel: www.moreservlets.com. Servlet and JSP training courses by book's author: courses.coreservlets.com.

## Chapter 7 Generating the Server Response: HTTP Response Headers

details (you can access RFCs on-line at one of the archive sites listed at http://www.rfc-editor.org/ ).

## Content-Length

This header indicates the number of bytes in the response. This information is needed only if the browser is using a persistent (keep-alive) HTTP connection. See the Connection header for determining when the browser supports persistent connections. If you want your servlet to take advantage of persistent connections when the browser supports it, your servlet should write the document into a ByteArrayOutputStream , look up its size when done, put that into the Content-Length field with response.setContentLength , then send the content via byteArrayStream.writeTo(response.getOutputStream()) . For an example of this approach, see Section 7.4.

## Content-Location

This header supplies an alternative address for the requested document. Content-Location is informational; responses that include this header also include the requested document, unlike the case with the Location header. This header is new to HTTP 1.1.

## Content-MD5

The Content-MD5 response header provides an MD5 digest for the subsequent document. This digest provides a message integrity check for clients that want to confirm they received the complete, unaltered document. See RFC 1864 for details on MD5. This header is new in HTTP 1.1.

## Content-Range

This new HTTP 1.1 header is sent with partial-document responses and specifies how much of the total document was sent. For example, a value of ' bytes 500-999/2345 ' means that the current response includes bytes 500 through 999 of a document that contains 2345 bytes in total.

## Content-Type

The Content-Type header gives the MIME (Multipurpose Internet Mail Extension) type of the response document. Setting this header is so common that there is a special method in HttpServletResponse for it: setContentType . MIME types are of the form maintype/subtype for officially registered types, and of the form maintype/x-subtype for

## 7.2 HTTP 1.1 Response Headers and Their Meaning

unregistered types. The default MIME type for servlets is text/plain , but servlets usually explicitly specify text/html . They can, however, specify other types instead. For example, Section 7.5 (Using Servlets to Generate GIF Images) presents a servlet that builds a GIF image based upon input provided by specifying the image/gif content type, and Section 11.2 (The contentType Attribute) shows how servlets and JSP pages can generate Excel spreadsheets by specifying a content type of application/vnd.ms-excel .

Table 7.1 lists some the most common MIME types used by servlets.

For more detail, many of the common MIME types are listed in RFC 1521 and RFC 1522 (again, see http://www.rfc-editor.org/ for a list of RFC archive sites). However, new MIME types are registered all the time, so a dynamic list is a better place to look. The officially registered types are listed at

http://www.isi.edu/in-notes/iana/assign-

ments/media-types/media-types

. For common unregistered types, is a good source.

http://www.ltsw.se/knbase/internet/mime.htp

## Table 7.1 Common MIME Types

| Type                                   | Meaning                     |
|----------------------------------------|-----------------------------|
| application/msword                     | Microsoft Word document     |
| application/octet-stream               | Unrecognized or binary data |
| application/pdf                        | Acrobat (.pdf) file         |
| application/postscript                 | PostScript file             |
| application/vnd.lotus-notes            | Lotus Notes file            |
| application/vnd.ms-excel               | Excel spreadsheet           |
| application/vnd.ms-powerpoint          | Powerpoint presentation     |
| application/x-gzip                     | Gzip archive                |
| application/x-java-archive             | JAR file                    |
| application/x-java-serial- ized-object | Serialized Java object      |
| application/x-java-vm                  | Java bytecode (.class) file |

<!-- image -->

## Chapter 7 Generating the Server Response: HTTP Response Headers

| Table 7.1       | MIME Types (continued)           |
|-----------------|----------------------------------|
| application/zip | Zip archive                      |
| audio/basic     | Sound file in .au or .snd format |
| audio/x-aiff    | AIFF sound file                  |
| audio/x-wav     | Microsoft Windows sound file     |
| audio/midi      | MIDI sound file                  |
| text/css        | HTML cascading style sheet       |
| text/html       | HTML document                    |
| text/plain      | Plain text                       |
| image/gif       | GIF image                        |
| image/jpeg      | JPEG image                       |
| image/png       | PNG image                        |
| image/tiff      | TIFF image                       |
| image/x-xbitmap | X Window bitmap image            |
| video/mpeg      | MPEG video clip                  |
| video/quicktime | QuickTime video clip             |

## Date

This header specifies the current date in GMT format. If you want to set the date from a servlet, use the setDateHeader method to specify it. That method saves you the trouble of formatting the date string properly, as would be necessary with response.setHeader("Date", "...") . However, most servers set this header automatically, so servlets don't usually need to.

## ETag

This new HTTP 1.1 header gives names to returned documents so that they can be referred to by the client later (as with the If-Match request header).

## Expires

This header stipulates the time at which the content should be considered out-of-date and thus no longer be cached. A servlet might use this

## 7.2 HTTP 1.1 Response Headers and Their Meaning

for a document that changes relatively frequently, to prevent the browser from displaying a stale cached value. For example, the following would instruct the browser not to cache the document for longer than 10 minutes

```
long currentTime = System.currentTimeMillis(); long tenMinutes = 10*60*1000; // In milliseconds response.setDateHeader("Expires",
```

currentTime + tenMinutes);

Also see the max-age value of the Cache-Control header.

## Last-Modified

This very useful header indicates when the document was last changed. The client can then cache the document and supply a date by an If-Modified-Since request header in later requests. This request is treated as a conditional GET , with the document only being returned if the Last-Modified date is later than the one specified for If-Modified-Since . Otherwise, a 304 ( Not Modified ) status line is returned, and the client uses the cached document. If you set this header explicitly, use the setDateHeader method to save yourself the bother of formatting GMT date strings. However, in most cases you simply implement the getLastModified method and let the standard service method handle If-Modified-Since requests. For an example, see Section 2.8 (An Example Using Servlet Initialization and Page Modification Dates).

## Location

This header, which should be included with all responses that have a status code in the 300s, notifies the browser of the document address. The browser automatically reconnects to this location and retrieves the new document. This header is usually set indirectly, along with a 302 status code, by the sendRedirect method of HttpServletResponse . An example is given in Section 6.3 (A Front End to Various Search Engines).

## Pragma

Supplying this header with a value of no-cache instructs HTTP 1.0 clients not to cache the document. However, support for this header was inconsistent with HTTP 1.0 browsers. In HTTP 1.1, ' Cache-Control: no-cache ' is a more reliable replacement.

Home page for this book: www.coreservlets.com; Home page for sequel: www.moreservlets.com. Servlet and JSP training courses by book's author: courses.coreservlets.com.

## Chapter 7 Generating the Server Response: HTTP Response Headers

## Refresh

This header indicates how soon (in seconds) the browser should ask for an updated page. For example, to tell the browser to ask for a new copy in 30 seconds, you would specify a value of 30 with response.setIntHeader("Refresh", 30)

Note that Refresh does not stipulate continual updates; it just specifies when the next update should be. So, you have to continue to supply Refresh in all subsequent responses, and sending a 204 ( No Content ) status code stops the browser from reloading further. For an example, see Section 7.3 (Persistent Servlet State and Auto-Reloading Pages).

Instead of having the browser just reload the current page, you can specify the page to load. You do this by supplying a semicolon and a URL after the refresh time. For example, to tell the browser to go to http://host/path after 5 seconds, you would do the following.

response.setHeader("Refresh", "5; URL=http://host/path")

This setting is useful for 'splash screens,' where an introductory image or message is displayed briefly before the real page is loaded.

## Note that this header is commonly set by

&lt;META HTTP-EQUIV="Refresh"

CONTENT="5; URL=http://host/path"&gt;

in the HEAD section of the HTML page, rather than as an explicit header from the server. That usage came about because automatic reloading or forwarding is something often desired by authors of static HTML pages. For servlets, however, setting the header directly is easier and clearer.

This header is not officially part of HTTP 1.1 but is an extension supported by both Netscape and Internet Explorer.

## Retry-After

This header can be used in conjunction with a 503 ( Service Unavailable ) response to tell the client how soon it can repeat its request.

## Server

This header identifies the Web server. Servlets don't usually set this; the Web server itself does.

## Set-Cookie

The Set-Cookie header specifies a cookie associated with the page. Each cookie requires a separate Set-Cookie header. Servlets should not use response.setHeader("Set-Cookie", ...) , but instead should use the special-purpose addCookie method of HttpServletResponse . For details, see Chapter 8 (Handling Cookies). Technically, Set-Cookie is not part of HTTP 1.1. It was originally a Netscape extension but is now very widely supported, including in both Netscape and Internet Explorer.

## Trailer

This new and rarely used HTTP 1.1 header identifies the header fields that are present in the trailer of a message that is sent with 'chunked' transfer-coding. See Section 3.6 of the HTTP 1.1 specification (RFC 2616) for details. Recall that http://www.rfc-editor.org/ maintains an up-to-date list of RFC archive sites.

## Transfer-Encoding

Supplying this header with a value of chunked indicates 'chunked' transfer-coding. See Section 3.6 of the HTTP 1.1 specification (RFC 2616) for details.

## Upgrade

This header is used when the client first uses the Upgrade request header to ask the server to switch to one of several possible new protocols. If the server agrees, it sends a 101 ( Switching Protocols ) status code and includes an Upgrade response header with the specific protocol it is switching to. This protocol negotiation is usually carried on by the server itself, not by a servlet.

## Vary

This rarely used new HTTP 1.1 header tells the client which headers can be used to determine if the response document can be cached.

## Via

This header is used by gateways and proxies to list the intermediate sites the request passed through. It is new in HTTP 1.1.

## Warning

This new and rarely used catchall header lets you warn clients about caching or content transformation errors.

## 7.2 HTTP 1.1 Response Headers and Their Meaning