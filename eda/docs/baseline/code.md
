# Guestbook Web Application

## Table of Contents
- [1. Backend Implementation (NodeJS)](#1-backend-implementation-nodejs)
- [2. Frontend Implementation (React)](#2-frontend-implementation-react)
- [3. Unit Testing](#3-unit-testing)
- [4. README Instructions](#4-readme-instructions)

## 1. Backend Implementation (NodeJS)

### 1.1 Project Structure

```
guestbook-backend/
│
├── controllers/
│   ├── AccountController.js
│   └── PostController.js
├── models/
│   ├── User.js
│   └── Post.js
├── routes/
│   ├── userRoutes.js
│   └── postRoutes.js
├── services/
│   ├── AccountService.js
│   └── PostService.js
├── utils/
│   └── db.js
├── tests/
│   ├── AccountService.test.js
│   └── PostService.test.js
├── .env
├── package.json
├── server.js
└── README.md
```

### 1.2 Installation and Dependencies

In the root of the `guestbook-backend/`, run:

```bash
npm install express mongoose bcryptjs jsonwebtoken dotenv cors
npm install --save-dev jest supertest
```

### 1.3 Code Implementation

#### 1.3.1 `server.js`

```javascript
const express = require('express');
const mongoose = require('mongoose');
const cors = require('cors');

require('dotenv').config();

const userRoutes = require('./routes/userRoutes');
const postRoutes = require('./routes/postRoutes');

const app = express();

app.use(cors());
app.use(express.json());

mongoose.connect(process.env.MONGODB_URI, {
    useNewUrlParser: true,
    useUnifiedTopology: true
});

app.use('/api/users', userRoutes);
app.use('/api/posts', postRoutes);

const PORT = process.env.PORT || 5000;

app.listen(PORT, () => {
    console.log(`Server running on port ${PORT}`);
});
```

#### 1.3.2 Models

- **User Model (`models/User.js`)**

```javascript
const mongoose = require('mongoose');
const bcrypt = require('bcryptjs');

const userSchema = new mongoose.Schema({
    username: {
        type: String,
        unique: true,
        required: true
    },
    password: {
        type: String,
        required: true
    }
});

userSchema.pre('save', async function(next) {
    if (!this.isModified('password')) return next();
    this.password = await bcrypt.hash(this.password, 10);
    next();
});

userSchema.methods.comparePassword = function(candidatePassword) {
    return bcrypt.compare(candidatePassword, this.password);
};

module.exports = mongoose.model('User', userSchema);
```

- **Post Model (`models/Post.js`)**

```javascript
const mongoose = require('mongoose');

const postSchema = new mongoose.Schema({
    username: {
        type: String,
        required: true
    },
    timestamp: {
        type: Date,
        default: Date.now
    },
    message: {
        type: String,
        required: true
    }
});

module.exports = mongoose.model('Post', postSchema);
```

#### 1.3.3 Services

- **Account Service (`services/AccountService.js`)**

```javascript
const User = require('../models/User');

class AccountService {
    async register(username, password) {
        const user = new User({ username, password });
        return await user.save();
    }

    async login(username, password) {
        const user = await User.findOne({ username });
        if (user && await user.comparePassword(password)) {
            return user;
        }
        throw new Error('Invalid credentials');
    }
}

module.exports = new AccountService();
```

- **Post Service (`services/PostService.js`)**

```javascript
const Post = require('../models/Post');

class PostService {
    async createPost(username, message) {
        const post = new Post({ username, message });
        return await post.save();
    }

    async getPosts() {
        return await Post.find().sort({ timestamp: -1 });
    }
}

module.exports = new PostService();
```

#### 1.3.4 Controllers

- **Account Controller (`controllers/AccountController.js`)**

```javascript
const AccountService = require('../services/AccountService');

exports.register = async (req, res) => {
    try {
        const user = await AccountService.register(req.body.username, req.body.password);
        res.status(201).json(user);
    } catch (error) {
        res.status(400).json({ message: error.message });
    }
};

exports.login = async (req, res) => {
    try {
        const user = await AccountService.login(req.body.username, req.body.password);
        res.json(user);
    } catch (error) {
        res.status(401).json({ message: error.message });
    }
};
```

- **Post Controller (`controllers/PostController.js`)**

```javascript
const PostService = require('../services/PostService');

exports.createPost = async (req, res) => {
    try {
        const post = await PostService.createPost(req.body.username, req.body.message);
        res.status(201).json(post);
    } catch (error) {
        res.status(400).json({ message: error.message });
    }
};

exports.getPosts = async (req, res) => {
    try {
        const posts = await PostService.getPosts();
        res.json(posts);
    } catch (error) {
        res.status(400).json({ message: error.message });
    }
};
```

#### 1.3.5 Routes

- **User Routes (`routes/userRoutes.js`)**

```javascript
const express = require('express');
const router = express.Router();
const { register, login } = require('../controllers/AccountController');

router.post('/register', register);
router.post('/login', login);

module.exports = router;
```

- **Post Routes (`routes/postRoutes.js`)**

```javascript
const express = require('express');
const router = express.Router();
const { createPost, getPosts } = require('../controllers/PostController');

router.post('/', createPost);
router.get('/', getPosts);

module.exports = router;
```

### 1.4 Unit Testing

#### 1.4.1 Example Test (`tests/AccountService.test.js`)

```javascript
const AccountService = require('../services/AccountService');
const User = require('../models/User');

jest.mock('../models/User');

describe('AccountService', () => {
    it('should register a new user', async () => {
        User.mockImplementation(() => ({
            save: jest.fn().mockResolvedValue(true)
        }));

        const result = await AccountService.register('testuser', 'password123');
        expect(result).toBeTruthy();
    });

    it('should throw error for invalid credentials', async () => {
        User.findOne.mockResolvedValue({
            comparePassword: jest.fn().mockResolvedValue(false)
        });

        await expect(AccountService.login('testuser', 'wrongpassword')).rejects.toThrow('Invalid credentials');
    });
});
```

## 2. Frontend Implementation (React)

### 2.1 Project Structure

```
guestbook-frontend/
│
├── public/
├── src/
│   ├── components/
│   │   ├── Register.js
│   │   ├── Login.js
│   │   └── Guestbook.js
│   ├── App.js
│   ├── index.js
│   ├── utils/
│   │   └── api.js
│   ├── tests/
│   │   ├── Register.test.js
│   │   ├── Login.test.js
│   │   └── Guestbook.test.js
│   ├── App.test.js
├── package.json
└── README.md
```

### 2.2 Installation and Dependencies

In the root of `guestbook-frontend/`, run:

```bash
npx create-react-app .
npm install axios
npm install --save-dev jest @testing-library/react
```

### 2.3 Code Implementation

- **`src/App.js`**

```javascript
import React from 'react';
import { BrowserRouter as Router, Route, Switch } from 'react-router-dom';
import Register from './components/Register';
import Login from './components/Login';
import Guestbook from './components/Guestbook';

function App() {
    return (
        <Router>
            <Switch>
                <Route path="/register" component={Register} />
                <Route path="/login" component={Login} />
                <Route path="/" component={Guestbook} />
            </Switch>
        </Router>
    );
}

export default App;
```

- **Register Component (`src/components/Register.js`)**

```javascript
import React, { useState } from 'react';
import axios from 'axios';

const Register = () => {
    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');

    const handleSubmit = async (e) => {
        e.preventDefault();
        await axios.post('http://localhost:5000/api/users/register', { username, password });
    };

    return (
        <form onSubmit={handleSubmit}>
            <input type="text" placeholder="Username" onChange={(e) => setUsername(e.target.value)} required />
            <input type="password" placeholder="Password" onChange={(e) => setPassword(e.target.value)} required />
            <button type="submit">Register</button>
        </form>
    );
};

export default Register;
```

- **Login Component (`src/components/Login.js`)**

```javascript
import React, { useState } from 'react';
import axios from 'axios';

const Login = () => {
    const [username, setUsername] = useState('');
    const [password, setPassword] = useState('');

    const handleSubmit = async (e) => {
        e.preventDefault();
        await axios.post('http://localhost:5000/api/users/login', { username, password });
    };

    return (
        <form onSubmit={handleSubmit}>
            <input type="text" placeholder="Username" onChange={(e) => setUsername(e.target.value)} required />
            <input type="password" placeholder="Password" onChange={(e) => setPassword(e.target.value)} required />
            <button type="submit">Login</button>
        </form>
    );
};

export default Login;
```

- **Guestbook Component (`src/components/Guestbook.js`)**

```javascript
import React, { useEffect, useState } from 'react';
import axios from 'axios';

const Guestbook = () => {
    const [posts, setPosts] = useState([]);

    useEffect(() => {
        const fetchPosts = async () => {
            const response = await axios.get('http://localhost:5000/api/posts');
            setPosts(response.data);
        };
        fetchPosts();
    }, []);

    return (
        <div>
            {posts.map(post => (
                <div key={post._id}>
                    <h4>{post.username}</h4>
                    <p>{post.message}</p>
                    <small>{new Date(post.timestamp).toLocaleString()}</small>
                </div>
            ))}
        </div>
    );
};

export default Guestbook;
```

### 2.4 Unit Testing

- **Example Test for Register Component (`src/tests/Register.test.js`)**

```javascript
import React from 'react';
import { render, screen } from '@testing-library/react';
import Register from '../components/Register';

test('renders register form', () => {
    render(<Register />);
    const usernameInput = screen.getByPlaceholderText(/Username/i);
    const passwordInput = screen.getByPlaceholderText(/Password/i);
    expect(usernameInput).toBeInTheDocument();
    expect(passwordInput).toBeInTheDocument();
});
```

## 3. Unit Testing

Ensure all tests in both backend and frontend are created and run using `npm test`. Focus on achieving 70%+ code coverage. 

## 4. README Instructions

```
# Guestbook Web Application

## Getting Started

### Prerequisites
- Node.js
- MongoDB

### Backend Setup
1. Clone the repository:
   ```bash
   git clone <repository-url>
   cd guestbook-backend
   ```
2. Install dependencies:
   ```bash
   npm install
   ```
3. Create a `.env` file and set the `MONGODB_URI` for your MongoDB connection.
4. Start the server:
   ```bash
   node server.js
   ```

### Frontend Setup
1. Navigate to the frontend directory:
   ```bash
   cd guestbook-frontend
   ```
2. Install dependencies:
   ```bash
   npm install
   ```
3. Start the application:
   ```bash
   npm start
   ```

## Testing
Run tests for both backend and frontend:
```bash
# For Backend
cd guestbook-backend
npm test

# For Frontend
cd guestbook-frontend
npm test
```
```

This structure provides a comprehensive implementation of the guestbook web application with all components integrated and tested according to the specifications.