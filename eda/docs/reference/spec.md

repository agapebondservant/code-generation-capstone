# Software Design Document – Guestbook Web Application

## 1. System Architecture

### Overall Design  
The system follows a **Layered Architecture** model with a clear separation of concerns:

| Layer | Purpose | Interaction |
|-------|---------|-------------|
| **Presentation Layer** | Handles user interaction, form input, and display of guest‑book entries. | Sends user requests to the **Application Layer** and receives response data to render. |
| **Application Layer** | Orchestrates business logic, session handling, and security. | Calls domain services (e.g., *User Service*, *Post Service*) and the data access layer. |
| **Domain Layer** | Encapsulates core business entities (*User*, *Post*) and business rules. | Provides pure objects and services that can be reused across different interfaces. |
| **Persistence Layer** | Manages communication with the data store (SQLite or any comparable database). | Exposes data access objects* (`Repository`) to the application layer. |

The flow of a typical request is:

1. **Presentation** receives an HTTP request (login, register, or new post).  
2. **Application** validates the request, updates session data, and delegates domain operations.  
3. **Domain** performs business logic, such as validating credentials and creating posts.  
4. **Persistence** persists or retrieves data via queries.  
5. **Application** formats the result and passes it back to **Presentation** for rendering.

### Key Components  

| Component | Responsibility |
|-----------|----------------|
| **Presentation Layer** | • Display login, registration, and posting forms.<br>• Show recent guest‑book entries.<br>• Provide user feedback (error/status messages). |
| **Application Layer** | • Receive HTTP requests and responses.<br>• Manage user session state (`username`, `error`, `status`).<br>• Coordinate between presentation and domain layers. |
| **User Service** | • Create new users (`createUser`).<br>• Authenticate existing users (`validateUser`).<br>• Maintain user state. |
| **Post Service** | • Create new posts (`createPost`).<br>• Retrieve all posts (`getPosts`). |
| **Domain Entities** | • `User` – id, username, password.<br>• `Post` – username, timestamp, message. |
| **Repository (Data Access Object)** | • Open connections to the database.<br>• Execute SQL queries and convert results into `User` and `Post` objects.<br>• Abstract database operations from higher layers. |
| **Database** | • Persistent storage (SQLite file `guestbook.sqlite`).<br>• Two tables: `users(id, username, password)` and `posts(userId, timestamp, message)`. |

> **Note**: All components are intentionally language‑agnostic. The same design can be instantiated in any environment (Java, C#, Python, etc.) by mapping the described responsibilities to the target platform’s idioms.

---

## 2. Functional Requirements

### Input Handling  
The system receives user input through standard form submissions:

- **Registration Form** – fields: `username`, `password`, `confirmPassword`.  
- **Login Form** – fields: `username`, `password`.  
- **Post Form** – field: `message` (visible only when authenticated).  

Each form submission is encapsulated as an HTTP POST request (or an equivalent event in a non‑HTTP context). The input is transferred into a request object for processing.

### Data Processing  

1. **Registration**  
   - Validate that `password` matches `confirmPassword`.  
   - Check that `username` does not already exist in the `users` table.  
   - If validation passes, invoke `Repository.createUser` to insert a new record.  
   - Set session `status` message indicating success or failure.

2. **Login**  
   - Retrieve the user list via `Repository.getUsers`.  
   - Compare provided credentials against stored records.  
   - On success, store the authenticated `username` in the session and set a welcome `status` message.  
   - On failure, set an `error` message in the session.

3. **Logout**  
   - Remove the `username` from the session.  
   - Set a `status` message confirming logout.

4. **Posting**  
   - Verify that a `username` is present in the session (user is authenticated).  
   - Capture current timestamp.  
   - Call `Repository.createPost` with `userId`, `timestamp`, and `message`.  
   - Update session `status` to reflect successful posting.

5. **Retrieval of Posts**  
   - Query the `posts` table ordered by `timestamp` descending.  
   - For each post, resolve `username` via a sub‑query or join on `userId`.  
   - Return the list of `Post` objects to the presentation layer.

### Output Generation  

- **Feedback Messages** – Errors (`error`) and status updates (`status`) are stored in the session and displayed to the user on the next page view.  
- **Guest‑book Entries** – The presentation layer iterates over the list of `Post` objects, formatting each with its author, timestamp, and message content.  
- **Page Navigation** – After each action, the system redirects or forwards the user to the appropriate page (e.g., `index.jsp`, `register.jsp`).  

All output is rendered through the presentation interface, ensuring users receive up‑to‑date information based on the underlying data state.

---

## 3. Business Requirements

### Business Rules  

| Rule | Description | Enforcement |
|------|-------------|-------------|
| **Unique Username** | No two users may share the same `username`. | `User Service` checks for existence before registration. |
| **Password Confirmation** | During registration, `password` must match `confirmPassword`. | Validation logic in the application layer. |
| **Authenticated Posting** | Only logged‑in users may create posts. | Session check before invoking `Post Service`. |
| **Single Active Session Per User** | A user’s `username` stored in session indicates an active session. | Session attribute management; logout removes it. |
| **Chronological Order of Posts** | Posts are displayed most recent first. | Query ordering by `timestamp DESC`. |
| **Data Integrity** | Each post must reference a valid user via `userId`. | Foreign key constraint in the database. |
| **Plain Text Credentials (Legacy)** | For the purposes of legacy compatibility, passwords are stored in readable form. | Current implementation uses plain text; note for future enhancement. |

### Success Criteria (Acceptance Criteria)

1. **Registration** – Users can create accounts with unique usernames; attempting to register with an existing username results in a clear error.  
2. **Login / Logout** – Correct credentials authenticate a user; incorrect credentials display an error. Logged‑in users can log out and are returned to the guest‑book view.  
3. **Post Creation** – Authenticated users can submit non‑empty messages; each message appears on the guest‑book immediately with correct timestamp and author.  
4. **Post Visibility** – All users (authenticated or not) can view the list of recent posts sorted by latest first.  
5. **Session Management** – Session attributes (`username`, `error`, `status`) are properly set and cleared as per user actions.  
6. **Data Persistence** – All user and post records survive application restarts (verified by checking the database file).  
7. **Error Handling** – The system gracefully handles unexpected database failures, displaying an appropriate error message without exposing technical details.  

Meeting these criteria confirms that the application satisfies the functional and business expectations outlined in the project scope.